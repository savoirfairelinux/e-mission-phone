<ion-view
  ng-class="ion-view-background"
  view-title="{{'diary.diary' | translate}}"
  translate-namespace="diary"
>
  <ion-nav-bar class="bar-stable">
  </ion-nav-bar>

  <!-- Refresh button -->
  <ion-nav-buttons side="right">
    <button class="button button-icon ion-refresh" ng-click="refresh()"></button>
  </ion-nav-buttons> 

	<ion-content class="diary-entry">

    <!-- Date picker -->
    <div style="text-align:center;">
      <button class="button button-icon icon ion-arrow-left-b date-picker-arrow" ng-click="prevDay()">
      </button>
      <button id="date-picker-button" class="date-picker-button" ng-click="pickDay()">
        {{currDay}}
      </button>
      <button class="button button-icon icon ion-arrow-right-b date-picker-arrow" ng-click="nextDay()">
      </button>
    </div>

		<ion-list>
      <ion-nav-view ></ion-nav-view>
      <!--
      This needs to be collection-repeat instead of ng-repeat on android.
      Otherwise, you can only scroll using the sidebar, scrolling on the map side does not work.
      I have no clue why this happens, but it is not worth it to understand
      this deeply. It is not purely a leaflet issue, but it also clearly something to
      do with leaflet because scrolling on the details part does work.

      If you want to change this from collection-repeat to ng-repeat, you
      MUST test on android first to make sure that the scrolling works.
      -->

      <div collection-repeat="tripgj in data.currDayTripWrappers">
        
        <ion-item class="diary-item">

          <div class="diary-start-time-tag">{{tripgj.display_start_time}}</div>

          <div class="diary-card">

            <!-- Map -->
            <leaflet class="diary-map" geojson="tripgj" id="$index" defaults="defaults" ng-click="toDetail(tripgj.data.id)"></leaflet>

            <div class="diary-infos">

              <!-- Button for details -->
              <div class="diary-detail-button ion-ios-arrow-right" ng-click="toDetail(tripgj.data.id)"></div>

              <!-- Distance and time -->
              <div
                class="diary-distance-time"
                translate=".distance-in-time"
                translate-value-distance="{{ tripgj.display_distance }}"
                translate-value-time="{{ tripgj.display_time }}"
              >
              </div>
              
              <!-- Modes percentages -->
              <div class="diary-modes-percents">
                <span
                  class="diary-modes-percents-text"
                  ng-if="!tripgj.isDraft"
                  ng-repeat="sectionPct in tripgj.percentages"
                >
                  <span class="diary-modes-percents-icon {{sectionPct.icon}}"></span>
                  <span>{{sectionPct.pct}}%</span>
                </span>
                <button
                  class="diary-button"
                  ng-if="tripgj.isDraft"
                  ng-click="explainDraft($event)"
                  translate
                >
                  {{'.draft'}}
                </button>
              </div>

              <!-- Locations -->
              <div class="diary-route">
                <div class="diary-street">
                  <i class="icon ion-ios-location" style="color: #1123CB;"></i>
                  {{tripgj.start_place.properties.display_name.split(',')[0]}}
                </div>
                <div class="diary-street">
                  <i class="icon ion-ios-location" style="color: #ff5251;"></i>
                  {{tripgj.end_place.properties.display_name.split(',')[0]}}
                </div>
              </div>
            
              <!-- Mode and purpose selection -->
              <div ng-repeat="input in userInputDetails" ng-attr-id="{{ 'userinput' + input.name }}">
                <button class="diary-button" ng-click ="openPopover($event, tripgj, input.name)">
                  <span ng-if="tripgj.userInput[input.name]" translate>
                    {{tripgj.userInput[input.name].text}}
                  </span>
                  <span ng-if="!tripgj.userInput[input.name]" translate>
                    {{input.choosetext}}
                  </span>
                </button>
              </div>
              
            </div>
            
          </div>

          <div class="diary-stop-time-tag">{{tripgj.display_end_time}}</div>
          
        </ion-item>

      </div>
		</ion-list>    
	</ion-content>
</ion-view>
